---
title: |
  \vspace{5cm} \LARGE "The Effects of Opening a Restaurant During a Pandemic"
author: "Wen Ma, Reem Alasadi,  Rachael Lam, Tim Stephens"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
  bookdown::pdf_document2:
thanks: 'Code and data are available at: https://github.com/wenmade/2178Paper2.git.'
abstract: In May and June of 2021, a random selection of Toronto restaurants were selected to open during the COVID-19 pandemic.\newpage
bibliography: restaurant_references.bib
toc: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(message = FALSE)
library(bookdown)
library(knitr)


library(tidyverse)
library(generator)
library(stringi)
library(kableExtra)
library(dplyr)
library(ggplot2)
library(janitor)
library(tidyr)
library(ggmap)
library(sf)
library(mapview)
library(gridExtra)

```

\pagebreak
# Introduction

The COVID-19 pandemic has induced global action and, in some instances, inaction, that has affected millions of people. With over 100 million confirmed cases and 2.4 million total deaths, the pandemic has caused suffering and distress for countless people [@bbc]. In other instances, it has brought immense fortune - Jeff Bezos’s wealth increased \$92 billion between March and August of 2020 [@oxfam]. It is estimated that he could give all his 876,000 employees a $105,000 bonus and still be as wealthy as he was before the outbreak of COVID-19 [@oxfam]. Unfortunately, this has been a fantasy for the majority of global citizens - and Canada is no exception. 

&nbsp; 

At the beginning of the pandemic, nearly a sixth of all Canadians applied for emergency benefits [@harris]. This has had enormous effects on the population’s mental health with 48% rating their mental health as eight or higher on a ten point scale in 2020 compared to 73% in 2018 [@statcan]. Concurrently, the COVID-19 pandemic has also caused disruptions in numerous industries, but with some of the most detrimental ones occurring in the consumer-facing service sector [@statcan]. Before the pandemic, the restaurant industry generated one out of every fifteen jobs, paying Canadians nearly \$30 billion in wages and benefits [@ourrest]. It also contributed $31 billion to Canada’s GDP annually, proving its economic value [@ourrest]. Unfortunately, the epidemic has generated massive unemployment and many restaurants have been shut down and will never reopen [@larue]. 

&nbsp;

In an effort to avoid further devastation to the restaurant community, Petit Poll has collaborated with the Ontario Government to examine the effects of COVID-19 on restaurants in Toronto and understand what provisions can be made. In this study, we reopened randomly selected restaurants in the Greater Toronto Area (GTA). The segment included restaurants of varying price points and those who had previously offered dine-in services. We then released a survey and compared the results to restaurants who did not have the opportunity to open and instead, remained closed. All restaurants were able to continue curb-side pickup and delivery services.

&nbsp;

This paper will first explore….




# Data 

## Description of Study 

At the time of this study, it was assumed that all restaurants in the Greater Toronto Area (GTA) were closed due to COVID-19. However, restaurants could continue to prepare food for curb-side pickup and delivery so their businesses could generate some income. This study looks at the effects of the lockdown on the restaurant industry and inspects the benefits of re-opening a business for a short amount of time during the pandemic. Keeping the restaurant business afloat in Toronto will be a monumental and expensive task. If risk can be mitigated, it could be justifiable to allow some restaurants to (temporarily) re-open. If so, they could generate enough income to survive the pandemic. Otherwise, the government could be looking at subsidies for each business – and with the sheer number of foodservice establishments in the GTA, this could add up quickly. 

&nbsp;

There are many foodservice establishments in Toronto, and it would be ideal to re-open everything. However, this is not a realistic option. Due to the nature of how COVID-19 spreads, it is still crucial that we limit the number of interactions people have with one another during the day. Therefore, we had to take a subsample from the larger foodservice establishment population. Since “dine-in” restaurants have had minimal opportunity to generate revenue during the pandemic, they were selected as the frame for this study. Foodservice establishments listed as “restaurant” in the City of Toronto’s Dinesafe dataset [@Dinesafe] were considered.
 
&nbsp;
 
The eligible businesses were then contacted by the Ontario Government via email or phone and were asked if they would like to participate in a trial re-opening. If they answered yes, they were added to a list. If they decided against the re-opening, or did not respond, they were not included in the study. After contacting the different businesses, the “yes” list was randomly subsampled into 2 groups, with a 50:50 chance to be placed in each group. The first group had the opportunity to re-open their business for a period of 2 months: May – June 2021. The other group was asked to remain closed to act as a control group. Participants who could re-open their business were issued a certification sticker that must have been visible from the street. At the end of the two months, a survey was released to the participants to gain information about their business, how it had been affected by the COVID-19 pandemic, and how much re-opening helped. 

&nbsp;

To entice the control group to complete the survey at the end of June, we initially discussed providing financial compensation. However, with over 7,000 eager-to-open restaurants in the GTA [@Dinesafe] this number would quickly escalate to an unrealistic proportion. Therefore, the Ontario Government has allowed the control group to re-open their business for two months as well – if they completed the survey (as compensation for participating). Those in the control group who completed the survey could open for the months of July and August (2021), but would no longer be part of the study. For more information on the survey including a detailed description and screenshots of the questions, see the Appendix. Because of the way this study has been structured, the cost remained relatively low – just a payment to Petit Poll for their work. 
&nbsp;

After completion of the study, Petit Poll analyzed the survey responses and presented them to the Ontario Government. Those restaurants who responded to the survey were considered part of the sample. The government must make the final decision if it is worth the risk to re-open businesses during the COVID-19 pandemic. Further studies may be needed to decide how many businesses should be allowed to open, and for how long.  

&nbsp;

## Dataset

This dataset was pulled from the City of Toronto’s Open Data Portal – Dinesafe [@Dinesafe]. The Open Data Portal is a regularly updated and open-sourced data delivery tool which allows users to “generate insights, analyses, and/or…develop web/mobile applications” (@CityOfToronto1, @CityOfToronto2). The dataset was analyzed using `R` [@R]. Various packages were used to analyze the data. First, `Opendatatoronto` [@opendatatoronto] and `sf` (@sf) were used to get the dataset from the open data portal. Next, the `Here` package [@here] was used for easily saving and locating files. The `Tidyverse` package [@tidyverse] was used for general analysis of the dataset. `Ggplot2` [@ggplot2], `knitr` [@knitr], `kableExtra` [@kableExtra], and `gridExtra` (@gridExtra) were used to create plots, tables, and figures. `Ggmap` (@ggmap) and `mapview` (@mapview) were used to create a map of the GTA and its respective restaurants. The `generator` package [@generator] was used to help simulate data. The `stringi` [@stringi] package was used to process strings in the dataset. The `janitor` package [@janitor] was used to clean the dataset. `TinyTex` [@tinytex] was used to help write the output to PDF. Finally, `bookdown` [@bookdown] was used to build the pdf and `bibtex` [@bibtex] was used to create references. 

&nbsp; 

The Dinesafe dataset was published by Toronto Public Health. Its main purpose is to record the number of inspections, infractions, and legal histories of different foodservice businesses in the GTA. In addition, it also holds basic information on all registered Torono foodservice establishments. After conducting an inspection of a respective foodservice location, a record of what was done or found is created and eventually transferred to a CSV file. Unregistered restaurants are not included in the dataset. 

&nbsp;

For the purposes of this study, we kept information about the business’ name, location, and type. Location included street address, latitude, and longitude. Information about inspections was removed from the dataset, as it fell outside the scope of this analysis. There were many variables from the survey that were added to the dataset. First, the restaurant ID was added, starting at 1 and increasing incrementally. The rest of the variables were randomly generating in R [@R]. Those variables were: Phone number 1, phone number 2, email, website, number of years in operation, franchise (y/n), own or lease, number of employees before the first lockdown, number of employees at the end of the first lockdown, number of employees during re-opening, the total number of weekly hours the restaurant was open before the lockdown, weekly hours during the lockdown, weekly hours during the temporary re-opening, delivery (y/n), curbside pickup (y/n), dine-in service (y/n), patio service (y/n), type of cuisine, serves alcohol (y/n), target pricepoint (low, average, high), income and profit for the months of May and June in 2019, 2020, 2021 (each with their own column), was the restaurant selected to re-open (y/n), and finally, helpfulness of the re-opening on a scale of 1 to 5. 

&nbsp; 


This dataset has strengths and weaknesses. For positives, this dataset is from a reputable source. It should contain all registered restaurants in the GTA. Nothing should be left out (unless the establishment is running illegally). Additionally, we have real restaurant names and locations to study, although locations were not a main source of interest in this study. In terms of weaknesses, Dinesafe did not specify how they classified different establishments. It is unknown what the differences are between different classes of establishments. For example, what is the specific difference between a "restaurant" and a "cafeteria"? Depending on how (or who) classified the different establishments, it is possible for bias to arise here. There is the possibility that an establishment that should be classified as one thing was classified as another. Another weakness of this dataset was that much of the information was simulated. With so many variables, the potential for error increased. Also, many assumptions were made about different probabilities. It is important to recognize that this study is merely a model developed on randomized data. It has potential to be used in the future on real data. 


## When Covid Strikes

A total of 7,221 surveys were collected and analysed to understand the effects of COVID-19 on the restaurant industry and the potential benefits of reopening for 2 months. Of the businesses that participated in the survey, income substantially decreased for all restaurants in a two month period between 2019 and 2020 by more than 75% (table 1 population graphs), confirming the detrimental consequence of lockdown for the restaurant industry. For restaurants whose income was less than the mean, these types of losses could quickly result in closure if intervention of subsidies are not put in place. Figure 1 further represents this income reduction, with the majority of businesses in 2020 profiting close to \$1000 and very few earning more than \$5000. 

&nbsp; 

In addition, restaurants saw a drastic decrease in the number of staff employed by more than 70% (table 2 population graphs). These losses indicate mass unemployment in the restaurant industry and the far reaching implications of COVID-19, which will be discussed in Section 3. All restaurants employed fewer than 20 staff and no restaurant employed more than 25 (Figure 2). This is compared to 2020 where there is a greater dispersion of numbers, with some restaurants employing over 60 people.

&nbsp; 

To understand the demographics of the surveyed businesses, we pulled information on their years of operation, type of operation and property ownership. It was discovered that the majority of businesses were non-franchised and were operational for less than five years. [insert reference to experiences of new businesses] Furthermore, the majority of properties were leased, creating additional costs that are difficult to maintain with a decrease in income. Of the businesses that completed the survey, 41.03% of restaurants were classified as low-end, 39.16% were classified as average and 19.8% were classified as high-end (table 3 population graphs). These restaurants were categorized accordingly as to not inflate or deflate the statistics between high-end and low-end restaurants in the analysis. 


## Low-End Restaurants 

Within the low-end restaurants, reopening for a two month period showed only significant improvements. Restaurants in the treatment group earned roughly 188% more than the control. Employment showed more significant improvements with an almost 247% increase in staff. In the end, treated restaurants were torn on the helpfulness scale, with the average response at 3.36. Although 34% of respondents scored a five, 21% still scored a one. This could be due to the effort that it takes to prepare a restaurant to open for a two month period, especially in the wake of COVID-19. The amount of personal protective equipment (PPE), training and sanitizing equipment needed could outweigh the benefits of opening.

## Middle-End Restaurants

Middle-end restaurants experienced fairly similar income outcomes compared to low-end restaurants. Restaurants in the treatment group saw a 179% increase in income in contrast to the control group. With this improvement, 38% of the restaurants categorized helpfulness as a five on the five point scale. Although an additional 19% of restaurants scored a four, there were still almost 19% that scored a one. In addition, employment experienced a 254% increase in staff, which are similar numbers compared to low-end restaurants. 

## High-End Restaurants

Finally, high-end restaurants experienced the smallest improvement in earnings, although by a fraction of a difference. The treatment group earned 178% more than the control group between May and June. The nature of high-end restaurants offering primarily dine-in service would assume that they would see the greatest positive effects of the reopening, yet they did not see as substantial of an increase as other price brackets. This could be due to lingering hesitancies surrounding COVID-19, or the number of people who experienced financial losses at this time. This increase in income could also be a factor in the 251% increase in staff. Expectedly, high-end restaurants saw the lowest positive response to the reopening, with 33% scoring a five and over 20% scoring a one.


# Discussion 


# Conclusion 

# Appendix

# Data randomizaion and business rules
```{r dataRandomization, echo=FALSE, message=FALSE, include=FALSE}

#### copy over column in data ####

dinesafeCSV <- read.csv('../../dataset/dinesafeCSV.csv', header=TRUE, sep=",")

#only keeping categories that is classified as Resturants
dinesafeCSV <- dinesafeCSV[dinesafeCSV$TYPE == 'Restaurant',]


#7221 obs in total
totalobs <- nrow(dinesafeCSV)


#### Establish some verctors ####

top_cuisine_list <- c("Chinese", "Mexican", "Italian", "Japanese", "Greek", "Korean", "Thai", "Vietnamese", "American",
                      "Indian", "Mediterranean", "Others");


business_op_list <- c("Under 1 year", "1-5 years", "6-10 years", "11-20 years", "Over 20 years");
business_owner_list <- c("Under 1 year", "1-5 years", "6-10 years", "11-20 years", "Over 20 years");
price_point_target <- c("Low-end", "Average", "High-end");
rating_list <- c("1", "2", "3", "4", "5");

#### Raw Survey Data Radomization ####

simulated_resturants <-
  tibble(
    ID = seq(1, totalobs), #auto generate index for each row of dataset
    Name = dinesafeCSV$NAME,
    Owner = r_full_names(totalobs),
    Mailing_Address = dinesafeCSV$ADDRESS, #from dinesafe
    Phone_1 = r_phone_numbers(totalobs), 
    Phone_2 = r_phone_numbers(totalobs),
    Email = r_email_addresses(totalobs),
    Website = paste(stri_rand_strings(totalobs, sample(8:16, 1, replace=TRUE), pattern = '[a-zA-Z0-9]'), "@", 
                    stri_rand_strings(totalobs, sample(3:5, 1, replace=TRUE), pattern = '[a-z]'), ".com"),
    Business_Operation_Year = sample(x = business_op_list, 
                                     size = totalobs,
                                     replace=TRUE,
                                     prob=c(0.2, 0.35, 0.15, 0.2, 0.1)),
    Franchise = sample(x = c ("Y", "N"), 
                       size=totalobs,
                       replace=TRUE,
                       prob=c(0.4, 0.6)), 
    Own_Lease = sample(x=c("Own", "Lease", "Lease, want to purchase"), 
                       size=totalobs,
                       replace=TRUE,
                       prob=c(0.4, 0.5, 0.1)),
    Number_Of_Staff_Before_Covid = runif(totalobs, min=5, max=70) %>% as.integer(), 
    Number_Of_Staff_During_Covid = runif(totalobs, min=1, max=20) %>% as.integer(), #cap staff to 20 max
    Number_Of_Staff_During_Reopen = runif(totalobs, min=1, max=70) %>% as.integer(), #cap staff to 70 max
    Total_Hours_Per_Week_Before_Covid = runif(totalobs, min=70, max=168) %>% as.integer(), 
    Total_Hours_Per_Week_During_Covid = runif(totalobs, min=0, max=70) %>% as.integer(),  #cap operation hours to 70 max
    Total_Hours_Per_Week_During_Reopen = runif(totalobs, min=40, max=98) %>% as.integer(), #cap oepration hours to 98 max
    Delivery = sample(x = c ("Y", "N"),
                      size=totalobs,
                      replace=TRUE,
                      prob=c(0.8, 0.2)),
    Curbside_Pickup = sample(x = c ("Y", "N"),
                             size=totalobs,
                             replace=TRUE,
                             prob=c(0.6, 0.4)),
    Dine_In_Service = sample(x = c ("Y", "N"),
                             size=totalobs,
                             replace=TRUE,
                             prob=c(0.7, 0.3)), 
    Patio_Service = sample(x = c ("Y", "N"),
                           size=totalobs,
                           replace=TRUE,
                           prob=c(0.15, 0.85)), 
    Cuisine = sample(x = top_cuisine_list, 
                     size = totalobs,
                     replace = TRUE,
                     prob = c(0.1, 0.12, 0.07, 0.1, 0.15, 0.05, 0.05, 0.08, 0.05, 0.07, 0.08, 0.08)), 
    Offer_Alcohol = sample(x = c ("Y", "N"),
                           size=totalobs,
                           replace=TRUE,
                           prob=c(0.4, 0.6)), 
    Price_Point_Target = sample(x=price_point_target, 
                                size=totalobs,
                                replace=TRUE,
                                prob=c(0.4, 0.4, 0.2)),
    Income_052019_062019 = runif(totalobs, min=120000, max=800000) %>% as.integer(), #Income_052019_062019
    Income_052020_062020 = runif(totalobs, min=60000, max=160000) %>% as.integer(),
    Income_052021_062021 = runif(totalobs, min=120000, max=800000) %>% as.integer(),
    Profit_052019_062019 = runif(totalobs, min=3600, max=24000) %>% as.integer(), #data filling using 0.03 from income
    Profit_052020_062020 = runif(totalobs, min=1800, max=4800) %>% as.integer(), 
    Profit_052021_062021 = runif(totalobs, min=3600, max=24000) %>% as.integer(),

    Selected_Open = sample(x = c ("Y", "N"),
                           size=totalobs,
                           replace=TRUE,
                           prob=c(0.5, 0.5)),

    Helpfulness = sample(x = rating_list, 
                         size = totalobs,
                         replace=TRUE,
                         prob=c(0.2, 0.1, 0.15, 0.2, 0.35)),
    
    Long = dinesafeCSV$LONGITUDE, #from dinesafe
    Lat = dinesafeCSV$LATITUDE #from dinesafe
  )


#Some data simulation to make it more realistic - all assumptions

#1. If resturant is selected to reopen, we allow assumptions to have profit from may-jun 2021,
#staff number for not reopened resturants stay the same as 2020, 1-20.
indexSY <- which(simulated_resturants$Selected_Open == "Y")
simulated_resturants$Profit_052021_062021[indexSY] <- runif(length(indexSY), min=3600, max=24000) %>% as.integer()
indexSN <- which(simulated_resturants$Selected_Open == "N")
simulated_resturants$Profit_052021_062021[indexSN] <- runif(length(indexSN), min=1800, max=4800) %>% as.integer()
simulated_resturants$Number_Of_Staff_During_Reopen[indexSN] <- runif(length(indexSN), min=1, max=20) %>% as.integer()

#2. If resturant is highend, we allow Income to be ---, if average, we allow income to be ---, if lowend, we allow income to be ----.
# For every raise in pricepoint, we cutdown half for the min, and 1.5million for the max. (2019)
indexIL <- which(simulated_resturants$Price_Point_Target == "Low-end")
simulated_resturants$Income_052019_062019[indexIL] <- runif(length(indexIL), min=120000, max=276667) %>% as.integer()
simulated_resturants$Income_052021_062021[indexIL] <- runif(length(indexIL), min=120000, max=276667) %>% as.integer()
indexIA <- which(simulated_resturants$Price_Point_Target == "Average")
simulated_resturants$Income_052019_062019[indexIA] <- runif(length(indexIA), min=176667, max=523333) %>% as.integer()
simulated_resturants$Income_052021_062021[indexIA] <- runif(length(indexIA), min=176667, max=523333) %>% as.integer()
indexIH <- which(simulated_resturants$Price_Point_Target == "High-end")
simulated_resturants$Income_052019_062019[indexIH] <- runif(length(indexIH), min=403333, max=800000) %>% as.integer()
simulated_resturants$Income_052021_062021[indexIH] <- runif(length(indexIH), min=403333, max=800000) %>% as.integer()

#cap resturants incomes assuming no resturant will make more profit/income than 2019. with random of 90% - 50% income
reduction2021 <- runif(totalobs, min=0.5, max=0.9)
simulated_resturants$Income_052021_062021[indexIL] <- floor(simulated_resturants$Income_052021_062021[indexIL]*reduction2021)
simulated_resturants$Income_052021_062021[indexIA] <- floor(simulated_resturants$Income_052021_062021[indexIA]*reduction2021)
simulated_resturants$Income_052021_062021[indexIH] <- floor(simulated_resturants$Income_052021_062021[indexIH]*reduction2021)

#2a. We assume that all resturants will receive lower income during covid, therefore, the max income from 052020 - 102020 will be based on the 052019-102019 minus a random 
# percentage from 30% - 70% 
reduction <- runif(totalobs, min=0.3, max=0.7)
calculatedmax = floor(simulated_resturants$Income_052019_062019*reduction)
simulated_resturants$Income_052020_062020 <- runif(totalobs, min=0, max=calculatedmax) %>% as.integer()

#2aa. If the resturant is not selected to open, 2021 income and profit goes down by 30% - 70% based on their 2019 data. 
# Profit is capped
indexIncProf <- which(simulated_resturants$Selected_Open == "N")
reductionIncProf <- runif(length(indexIncProf), min=0.85, max=1.15)
simulated_resturants$Income_052021_062021[indexIncProf] <- floor(simulated_resturants$Income_052020_062020[indexIncProf]*reductionIncProf)


#2b. If resturant is highend, we allow Profit to be 20000 - 40000, if average, we allow profit to be 10000 - 25000, if low-end, we allow profit to be 0-10000.
# For every raise in pricepoint, we cutdown half for the min, and 15000 for the max. (2019)
profitpercentage <- runif(totalobs, min=0.02, max=0.045)

indexPL <- which(simulated_resturants$Price_Point_Target == "Low-end")
simulated_resturants$Profit_052019_062019[indexPL] <- floor(simulated_resturants$Income_052019_062019[indexPL]*profitpercentage)
simulated_resturants$Profit_052021_062021[indexPL] <- floor(simulated_resturants$Income_052021_062021[indexPL]*profitpercentage)
indexPA <- which(simulated_resturants$Price_Point_Target == "Average")
simulated_resturants$Profit_052019_062019[indexPA] <- floor(simulated_resturants$Income_052019_062019[indexPA]*profitpercentage)
simulated_resturants$Profit_052021_062021[indexPA] <- floor(simulated_resturants$Income_052021_062021[indexPA]*profitpercentage)
indexPH <- which(simulated_resturants$Price_Point_Target == "High-end")
simulated_resturants$Profit_052019_062019[indexPH] <- floor(simulated_resturants$Income_052019_062019[indexPH]*profitpercentage)
simulated_resturants$Profit_052021_062021[indexPH] <- floor(simulated_resturants$Income_052021_062021[indexPH]*profitpercentage)



#2c. We assume that all resturants will receive lower profit during covid, therefore, the max profit from 052020 - 102020 will be based on the 052019-102019 minus a random 
# percentage from 30% - 70% with cap of 25000
reductionP <- runif(totalobs, min=0.3, max=0.7)
calculatedmaxP <- floor(simulated_resturants$Profit_052019_062019 - simulated_resturants$Profit_052019_062019*reductionP)
simulated_resturants$Profit_052020_062020 <- runif(totalobs, min=0, max=calculatedmaxP) %>% as.integer()



#2d. If the resturant is not selected to open and not offering curb-side pick up or delivery, 
#we assume the profit and income would be 0.(2020 and 2021)
indexNCND <- which(simulated_resturants$Selected_Open == "N" && 
                     simulated_resturants$Curbside_Pickup == "N" && 
                     simulated_resturants$Delivery == "N")
simulated_resturants$Profit_052021_062021[indexNCND] <- 0
simulated_resturants$Income_052021_062021[indexNCND] <- 0
simulated_resturants$Profit_052020_062020[indexNCND] <- 0
simulated_resturants$Income_052020_062020[indexNCND] <- 0
simulated_resturants$Total_Hours_Per_Week_During_Reopen[indexNCND] <- 0

#3. If the resturant offers dine-in service, 
#we make assumption to reduce the income and profit by 30% - 50% of its current number (2021).
indexDIS <- which(simulated_resturants$Dine_In_Service == "Y" && simulated_resturants$Selected_Open == "N")
reductionDIS <- runif(length(indexDIS), min=0.5, max=0.7)
simulated_resturants$Income_052021_062021[indexDIS] <- floor(simulated_resturants$Income_052021_062021[indexDIS]*reductionDIS)
simulated_resturants$Profit_052021_062021[indexDIS] <- floor(simulated_resturants$Profit_052021_062021[indexDIS]*reductionDIS)


#4. If resturant is selected to open, helpfulness is under assumption of 1-5, otherwise, fill in 0
indexHN <- which(simulated_resturants$Selected_Open == "N")
simulated_resturants$Helpfulness[indexHN] <- 0


#5. If the resturant is lease, then profit goes down 20% - 40%. (all years)
indexLe <- which(simulated_resturants$Own_Lease == "Lease" || simulated_resturants$Own_Lease == "Lease, want to purchase")
reductionLe <- runif(length(indexLe), min=0.6, max=0.8)
simulated_resturants$Profit_052019_062019[indexLe] <- floor(simulated_resturants$Profit_052019_062019[indexLe]*reductionLe)
simulated_resturants$Profit_052020_062020[indexLe] <- floor(simulated_resturants$Profit_052020_062020[indexLe]*reductionLe)
simulated_resturants$Profit_052021_062021[indexLe] <- floor(simulated_resturants$Profit_052021_062021[indexLe]*reductionLe)

#5. Randomly fill in NA value for website to make it look real(er)
index <- which(simulated_resturants$Website %in% sample(simulated_resturants$Website, 456))
simulated_resturants$Website[index]<- NA

#6. Randomization bug: if curb-side pickup, delivery and dine-in all filled with N, then we assume the resturant does delivery
indexDineBug <- which(simulated_resturants$Dine_In_Service == "N" && 
                     simulated_resturants$Curbside_Pickup == "N" && 
                     simulated_resturants$Delivery == "N")
simulated_resturants$Delivery[indexDineBug] <- "Y"

#6. Randomization bug: if income is lower than profit of the year, then set income to profit
indexProfIncBug19 <- which(simulated_resturants$Income_052019_062019 < simulated_resturants$Profit_052019_062019)
simulated_resturants$Income_052019_062019[indexProfIncBug19] <- simulated_resturants$Profit_052019_062019[indexProfIncBug19]
indexProfIncBug20 <- which(simulated_resturants$Income_052020_062020 < simulated_resturants$Profit_052020_062020)
simulated_resturants$Income_052020_062020[indexProfIncBug20] <- simulated_resturants$Profit_052020_062020[indexProfIncBug20]
indexProfIncBug21 <- which(simulated_resturants$Income_052021_062021 < simulated_resturants$Profit_052021_062021)
simulated_resturants$Income_052021_062021[indexProfIncBug21] <- simulated_resturants$Profit_052021_062021[indexProfIncBug21]

# Write final csv for cleaning and preparation
write_csv(simulated_resturants, "../../dataset/raw_data_all_resturants.csv")
```

# Separate data into sample and control group
```{r sampleControlGroup, echo=FALSE, message=FALSE, include=FALSE}
#Load exported CSV file
all_resturants= read.csv('../../dataset/raw_data_all_resturants.csv', stringsAsFactors = FALSE)


#Get rid of unuseful columns
resturants_data <- all_resturants[, -c(3:8)] #Got rid of basic business contact information.

#convert some variable types
resturants_data$Business_Operation_Year <- as.factor(resturants_data$Business_Operation_Year)
resturants_data$Franchise <- as.factor(resturants_data$Franchise)
resturants_data$Own_Lease <- as.factor(resturants_data$Own_Lease)
resturants_data$Delivery <- as.factor(resturants_data$Delivery)
resturants_data$Curbside_Pickup <- as.factor(resturants_data$Curbside_Pickup)
resturants_data$Dine_In_Service <- as.factor(resturants_data$Dine_In_Service)
resturants_data$Patio_Service <- as.factor(resturants_data$Patio_Service)
resturants_data$Cuisine <- as.factor(resturants_data$Cuisine)
resturants_data$Offer_Alcohol <- as.factor(resturants_data$Offer_Alcohol)
resturants_data$Price_Point_Target <- as.factor(resturants_data$Price_Point_Target)
resturants_data$Helpfulness_Factor <- as.factor(resturants_data$Helpfulness) #added this to draw some graphs as factor

#Check null
is.null(resturants_data)
apply(resturants_data, 2, function(x) any(is.na(x)))

write_csv(resturants_data, "../../dataset/all_resturants.csv")


# No null value, ready to go
# We are only analyzing people who are selected to reopen, therefore, filter the original dataset into only selected to open

sample_resturants_data <- resturants_data[resturants_data$Selected_Open == 'Y',]
control_resturants_data <- resturants_data[resturants_data$Selected_Open == 'N',]
#3529 records remain





# Write final csv for analysis
write_csv(sample_resturants_data, "../../dataset/sample_resturants.csv")
write_csv(control_resturants_data, "../../dataset/control_resturants.csv")


```

# Sample group separation and export

```{r sampleSeparation, echo=FALSE, message=FALSE, include=FALSE}
sample_resturants = read.csv('../../dataset/sample_resturants.csv', stringsAsFactors = FALSE)

#get three tiers of resturants
sample_low_end_rest <- sample_resturants[sample_resturants$Price_Point_Target == "Low-end", ] 
sample_average_rest <- sample_resturants[sample_resturants$Price_Point_Target == "Average", ]
sample_high_end_rest <- sample_resturants[sample_resturants$Price_Point_Target == "High-end", ]


write_csv(sample_low_end_rest, "../../dataset/sample_low_end_resturants.csv")
write_csv(sample_average_rest, "../../dataset/sample_average_resturants.csv")
write_csv(sample_high_end_rest, "../../dataset/sample_high_end_resturants.csv")

```

#  Control group separation and export

```{r controlSeparation, echo=FALSE, message=FALSE, include=FALSE}

control_resturants = read.csv('../../dataset/control_resturants.csv', stringsAsFactors = FALSE)

#get three tiers of resturants
control_low_end_rest <- sample_resturants[control_resturants$Price_Point_Target == "Low-end", ] 
control_average_rest <- sample_resturants[control_resturants$Price_Point_Target == "Average", ]
control_high_end_rest <- sample_resturants[control_resturants$Price_Point_Target == "High-end", ]


write_csv(control_low_end_rest, "../../dataset/sample_low_end_resturants.csv")
write_csv(control_average_rest, "../../dataset/sample_average_resturants.csv")
write_csv(control_high_end_rest, "../../dataset/sample_high_end_resturants.csv")

```

# All "population" group analysis
```{r populationAnaysis, echo=FALSE, message=FALSE}
all_pop_resturants = read.csv('../../dataset/all_resturants.csv', stringsAsFactors = FALSE)
#Business operation year freq table
kbl(tabyl(all_pop_resturants$Business_Operation_Year, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
# 1-5 years owns takes 36% of dataset

#Frachaise
kbl(tabyl(all_pop_resturants$Franchise, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#Even split - 59% Non frachaise vs. 41% frachaise

#Own / Lease
kbl(tabyl(all_pop_resturants$Own_Lease, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#Lease 50%, own 40%, lease to own 10%


#Pricepoint
kbl(tabyl(all_pop_resturants$Price_Point_Target, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#Average 39%, Low-end 40%, High-end 21%

#Dine-in Service
kbl(tabyl(all_pop_resturants$Dine_In_Service, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#70% Y 30% N


#Helpfulness
kbl(tabyl(all_pop_resturants$Helpfulness_Factor, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#average split of 33%





#Average of everything table
ave_Income2019 <- mean(all_pop_resturants$Income_052019_062019)
ave_Income2020 <- mean(all_pop_resturants$Income_052020_062020)
ave_Income2021 <- mean(all_pop_resturants$Income_052021_062021)
ave_Profit2019 <- mean(all_pop_resturants$Profit_052019_062019)
ave_Profit2020 <- mean(all_pop_resturants$Profit_052020_062020)
ave_Profit2021 <- mean(all_pop_resturants$Profit_052021_062021)
ave_Staff2019 <- mean(all_pop_resturants$Number_Of_Staff_Before_Covid)
ave_Staff2020 <- mean(all_pop_resturants$Number_Of_Staff_During_Covid)
ave_Staff2021 <- mean(all_pop_resturants$Number_Of_Staff_During_Reopen)

average_table <- data.frame("ave_Income2019" = ave_Income2019, 
                            "ave_Income2020" = ave_Income2020, 
                            "ave_Income2021" = ave_Income2021, 
                            "ave_Profit2019" = ave_Profit2019, 
                            "ave_Profit2020" = ave_Profit2020, 
                            "ave_Profit2021" = ave_Profit2021)

average_staff <- data.frame(
                              "ave_Staff2019" = ave_Staff2019, 
                            "ave_Staff2020" = ave_Staff2020, 
                            "ave_Staff2021" = ave_Staff2021
)
kbl(average_table, booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))

kbl(average_staff, booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))



#Profit for all population graph
all_pop_plot_profit <- data.frame(Profit_05_062019 = all_pop_resturants$Profit_052019_062019, 
                                  Profit_05_062020 = all_pop_resturants$Profit_052020_062020, 
                                  Profit_05_062021 = all_pop_resturants$Profit_052021_062021)
all_pop_plot_profit <- gather(all_pop_plot_profit)


ggplot(all_pop_plot_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.2) + guides(fill=guide_legend(title="Surveyed resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))

paste("Min 2019:", min(all_pop_resturants$Profit_052019_062019))
paste("Mean 2019:", mean(all_pop_resturants$Profit_052019_062019))
paste("Max 2019:", max(all_pop_resturants$Profit_052019_062019))
paste("Min 2020:", min(all_pop_resturants$Profit_052020_062020))
paste("Mean 2020:", mean(all_pop_resturants$Profit_052020_062020))
paste("Max 2020:", max(all_pop_resturants$Profit_052020_062020))
paste("Min 2021:", min(all_pop_resturants$Profit_052021_062021))
paste("Mean 2021:", mean(all_pop_resturants$Profit_052021_062021))
paste("Max 2021:", max(all_pop_resturants$Profit_052021_062021))



#Income for all population graph

all_pop_plot_income <- data.frame(Income_05_062019 = all_pop_resturants$Income_052019_062019, 
                          Income_05_062020 = all_pop_resturants$Income_052020_062020, 
                           Income_05_062021 = all_pop_resturants$Income_052021_062021)
all_pop_plot_income <- gather(all_pop_plot_income)


ggplot(all_pop_plot_income, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.2) + guides(fill=guide_legend(title="Surveyed resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))

paste("Min 2019:", min(all_pop_resturants$Income_052019_062019))
paste("Mean 2019:", mean(all_pop_resturants$Income_052019_062019))
paste("Max 2019:", max(all_pop_resturants$Income_052019_062019))
paste("Min 2020:", min(all_pop_resturants$Income_052020_062020))
paste("Mean 2020:", mean(all_pop_resturants$Income_052020_062020))
paste("Max 2020:", max(all_pop_resturants$Income_052020_062020))
paste("Min 2021:", min(all_pop_resturants$Income_052021_062021))
paste("Mean 2021:", mean(all_pop_resturants$Income_052021_062021))
paste("Max 2021:", max(all_pop_resturants$Income_052021_062021))



#Staff for all population graph

all_pop_plot_Staff <- data.frame(Staff_05_062019 = all_pop_resturants$Number_Of_Staff_Before_Covid, 
                         Staff_05_062020 = all_pop_resturants$Number_Of_Staff_During_Covid, 
                          Staff_05_062021 = all_pop_resturants$Number_Of_Staff_During_Reopen)
all_pop_plot_Staff <- gather(all_pop_plot_Staff)


ggplot(all_pop_plot_Staff, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.2) + guides(fill=guide_legend(title="Surveyed resturants staff"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))

```

# Sample group analysis

```{r sampleAnaysis, echo=FALSE, message=FALSE}

#Business operation year freq table
kbl(tabyl(sample_resturants$Business_Operation_Year, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
# 1-5 years owns takes 36% of dataset

#Frachaise
kbl(tabyl(sample_resturants$Franchise, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#Even split - 59% Non frachaise vs. 41% frachaise

#Own / Lease
kbl(tabyl(sample_resturants$Own_Lease, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#Lease 50%, own 40%, lease to own 10%


#Pricepoint
kbl(tabyl(sample_resturants$Price_Point_Target, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#Average 39%, Low-end 40%, High-end 21%

#Dine-in Service
kbl(tabyl(sample_resturants$Dine_In_Service, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#70% Y 30% N


#Helpfulness
kbl(tabyl(sample_resturants$Helpfulness_Factor, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#average split of 33%

#Average of everything table
ave_Income2019 <- mean(sample_resturants$Income_052019_062019)
ave_Income2020 <- mean(sample_resturants$Income_052020_062020)
ave_Income2021 <- mean(sample_resturants$Income_052021_062021)
ave_Profit2019 <- mean(sample_resturants$Profit_052019_062019)
ave_Profit2020 <- mean(sample_resturants$Profit_052020_062020)
ave_Profit2021 <- mean(sample_resturants$Profit_052021_062021)
ave_Staff2019 <- mean(sample_resturants$Number_Of_Staff_Before_Covid)
ave_Staff2020 <- mean(sample_resturants$Number_Of_Staff_During_Covid)
ave_Staff2021 <- mean(sample_resturants$Number_Of_Staff_During_Reopen)
ave_helpfulness <- mean(as.integer(sample_resturants$Helpfulness))

average_table <- data.frame("ave_Income2019" = ave_Income2019, 
                            "ave_Income2020" = ave_Income2020, 
                            "ave_Income2021" = ave_Income2021, 
                            "ave_Profit2019" = ave_Profit2019, 
                            "ave_Profit2020" = ave_Profit2020, 
                            "ave_Profit2021" = ave_Profit2021)

average_staff <- data.frame(
                              "ave_Staff2019" = ave_Staff2019, 
                            "ave_Staff2020" = ave_Staff2020, 
                            "ave_Staff2021" = ave_Staff2021, 
                            "ave_Helpfulness" = ave_helpfulness
)
kbl(average_table, booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))

kbl(average_staff, booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))


#sample population profit 
sample_pop_plot_profit <- data.frame(Profit_052019_062019 = sample_resturants$Profit_052019_062019, 
                                  Profit_052020_062020 = sample_resturants$Profit_052020_062020, 
                                  Profit_052021_062021 = sample_resturants$Profit_052021_062021)
sample_pop_plot_profit <- gather(sample_pop_plot_profit)


ggplot(sample_pop_plot_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.2)


paste("Sample Profit Min 2019:", min(sample_resturants$Profit_052019_062019))
paste("Sample Profit Mean 2019:", mean(sample_resturants$Profit_052019_062019))
paste("Sample Profit Max 2019:", max(sample_resturants$Profit_052019_062019))
paste("Sample Profit Min 2020:", min(sample_resturants$Profit_052020_062020))
paste("Sample Profit Mean 2020:", mean(sample_resturants$Profit_052020_062020))
paste("Sample Profit Max 2020:", max(sample_resturants$Profit_052020_062020))
paste("Sample Profit Min 2021:", min(sample_resturants$Profit_052021_062021))
paste("Sample Profit Mean 2021:", mean(sample_resturants$Profit_052021_062021))
paste("Sample Profit Max 2021:", max(sample_resturants$Profit_052021_062021))


sample_pop_plot_income <- data.frame(Income_052019_062019 = sample_resturants$Income_052019_062019, 
                          Income_052020_062020 = sample_resturants$Income_052020_062020, 
                           Income_052021_062021 = sample_resturants$Income_052021_062021)
sample_pop_plot_income <- gather(sample_pop_plot_income)


ggplot(sample_pop_plot_income, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.2)

paste("Min 2019:", min(sample_resturants$Income_052019_062019))
paste("Mean 2019:", mean(sample_resturants$Income_052019_062019))
paste("Max 2019:", max(sample_resturants$Income_052019_062019))
paste("Min 2020:", min(sample_resturants$Income_052020_062020))
paste("Mean 2020:", mean(sample_resturants$Income_052020_062020))
paste("Max 2020:", max(sample_resturants$Income_052020_062020))
paste("Min 2021:", min(sample_resturants$Income_052021_062021))
paste("Mean 2021:", mean(sample_resturants$Income_052021_062021))
paste("Max 2021:", max(sample_resturants$Income_052021_062021))



```

# Control group analysis

```{r controlpopulation, echo=FALSE, message=FALSE}
control_resturants = read.csv('../../dataset/control_resturants.csv', stringsAsFactors = FALSE)
#Business operation year freq table
kbl(tabyl(control_resturants$Business_Operation_Year, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
# 1-5 years owns takes 36% of dataset

#Frachaise
kbl(tabyl(control_resturants$Franchise, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#Even split - 59% Non frachaise vs. 41% frachaise

#Own / Lease
kbl(tabyl(control_resturants$Own_Lease, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#Lease 50%, own 40%, lease to own 10%


#Pricepoint
kbl(tabyl(control_resturants$Price_Point_Target, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#Average 39%, Low-end 40%, High-end 21%

#Dine-in Service
kbl(tabyl(control_resturants$Dine_In_Service, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#70% Y 30% N


#Helpfulness
kbl(tabyl(control_resturants$Helpfulness_Factor, sort = TRUE), booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))
#average split of 33%

#Average of everything table
ave_Income2019 <- mean(control_resturants$Income_052019_062019)
ave_Income2020 <- mean(control_resturants$Income_052020_062020)
ave_Income2021 <- mean(control_resturants$Income_052021_062021)
ave_Profit2019 <- mean(control_resturants$Profit_052019_062019)
ave_Profit2020 <- mean(control_resturants$Profit_052020_062020)
ave_Profit2021 <- mean(control_resturants$Profit_052021_062021)
ave_Staff2019 <- mean(control_resturants$Number_Of_Staff_Before_Covid)
ave_Staff2020 <- mean(control_resturants$Number_Of_Staff_During_Covid)
ave_Staff2021 <- mean(control_resturants$Number_Of_Staff_During_Reopen)

average_table <- data.frame("ave_Income2019" = ave_Income2019, 
                            "ave_Income2020" = ave_Income2020, 
                            "ave_Income2021" = ave_Income2021, 
                            "ave_Profit2019" = ave_Profit2019, 
                            "ave_Profit2020" = ave_Profit2020, 
                            "ave_Profit2021" = ave_Profit2021)

average_staff <- data.frame(
                              "ave_Staff2019" = ave_Staff2019, 
                            "ave_Staff2020" = ave_Staff2020, 
                            "ave_Staff2021" = ave_Staff2021
)
kbl(average_table, booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))

kbl(average_staff, booktabs = T) %>%
  kable_styling(latex_options = c("striped", "scale-down"))

control_pop_plot_profit <- data.frame(Profit_052019_062019 = control_resturants$Profit_052019_062019, 
                                  Profit_052020_062020 = control_resturants$Profit_052020_062020, 
                                  Profit_052021_062021 = control_resturants$Profit_052021_062021)
control_pop_plot_profit <- gather(control_pop_plot_profit)


ggplot(control_pop_plot_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.2)
paste("Min 2019:", min(control_resturants$Profit_052019_062019))
paste("Mean 2019:", mean(control_resturants$Profit_052019_062019))
paste("Max 2019:", max(control_resturants$Profit_052019_062019))
paste("Min 2020:", min(control_resturants$Profit_052020_062020))
paste("Mean 2020:", mean(control_resturants$Profit_052020_062020))
paste("Max 2020:", max(control_resturants$Profit_052020_062020))
paste("Min 2021:", min(control_resturants$Profit_052021_062021))
paste("Mean 2021:", mean(control_resturants$Profit_052021_062021))
paste("Max 2021:", max(control_resturants$Profit_052021_062021))



ontrol_pop_plot_income <- data.frame(Income_052019_062019 = control_resturants$Income_052019_062019, 
                          Income_052020_062020 = control_resturants$Income_052020_062020, 
                           Income_052021_062021 = control_resturants$Income_052021_062021)
ontrol_pop_plot_income <- gather(ontrol_pop_plot_income)


ggplot(ontrol_pop_plot_income, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.2)

paste("Min 2019:", min(control_resturants$Income_052019_062019))
paste("Mean 2019:", mean(control_resturants$Income_052019_062019))
paste("Max 2019:", max(control_resturants$Income_052019_062019))
paste("Min 2020:", min(control_resturants$Income_052020_062020))
paste("Mean 2020:", mean(control_resturants$Income_052020_062020))
paste("Max 2020:", max(control_resturants$Income_052020_062020))
paste("Min 2021:", min(control_resturants$Income_052021_062021))
paste("Mean 2021:", mean(control_resturants$Income_052021_062021))
paste("Max 2021:", max(control_resturants$Income_052021_062021))




```

# Graphs for sample and control group comparison

```{r all graphs, echo=FALSE, message=FALSE}
control_resturants = read.csv('../../dataset/control_resturants.csv', stringsAsFactors = FALSE)
sample_resturants = read.csv('../../dataset/sample_resturants.csv', stringsAsFactors = FALSE)

control_low_end_rest = read.csv('../../dataset/control_low_end_resturants.csv', stringsAsFactors = FALSE)
control_average_rest = read.csv('../../dataset/control_average_resturants.csv', stringsAsFactors = FALSE)
control_high_end_rest = read.csv('../../dataset/control_high_end_resturants.csv', stringsAsFactors = FALSE)

sample_low_end_rest = read.csv('../../dataset/sample_low_end_resturants.csv', stringsAsFactors = FALSE)
sample_average_rest = read.csv('../../dataset/sample_average_resturants.csv', stringsAsFactors = FALSE)
sample_high_end_rest = read.csv('../../dataset/sample_high_end_resturants.csv', stringsAsFactors = FALSE)





#Plot all control resturants - income

control_resturants_plot <- data.frame(Income_05_062019 = control_resturants$Income_052019_062019, 
                                      Income_05_062020 = control_resturants$Income_052020_062020, 
                                   Income_05_062021 = control_resturants$Income_052021_062021)
control_resturants_plot <- gather(control_resturants_plot)

income_control_all <- ggplot(control_resturants_plot, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control resturants income"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


#Plot all sample resturants - income

sample_resturants_plot <- data.frame(Income_05_062019 = sample_resturants$Income_052019_062019, 
                                     Income_05_062020 = sample_resturants$Income_052020_062020, 
                                    Income_05_062021 = sample_resturants$Income_052021_062021)
sample_resturants_plot <- gather(sample_resturants_plot)

income_sample_all <-ggplot(sample_resturants_plot, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample resturants income"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(income_control_all, income_sample_all, ncol=2, top = "Income comparision between all sample and control group")


#Plot all control resturants - profit

control_resturants_plot_profit <- data.frame(Profit_05_062019 = control_resturants$Profit_052019_062019, 
                                      Profit_05_062020 = control_resturants$Profit_052020_062020, 
                                      Profit_05_062021 = control_resturants$Profit_052021_062021)
control_resturants_plot_profit <- gather(control_resturants_plot_profit)

profit_control_all <- ggplot(control_resturants_plot_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


#Plot all sample resturants - profit

sample_resturants_plot_profit <- data.frame(Profit_05_062019 = sample_resturants$Profit_052019_062019, 
                                            Profit_05_062020 = sample_resturants$Profit_052020_062020, 
                                            Profit_05_062021 = sample_resturants$Profit_052021_062021)
sample_resturants_plot_profit <- gather(sample_resturants_plot_profit)

profit_sample_all <-ggplot(sample_resturants_plot_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(profit_control_all, profit_sample_all, ncol=2, top = "Profit comparision between all sample and control group")


#Plot all control resturants - staff

control_resturants_plot_staff <- data.frame(Staff_05_062019 = control_resturants$Number_Of_Staff_Before_Covid, 
                                            Staff_05_062020 = control_resturants$Number_Of_Staff_During_Covid, 
                                            Staff_05_062021 = control_resturants$Number_Of_Staff_During_Reopen)
control_resturants_plot_staff <- gather(control_resturants_plot_staff)

control_all_staff <- ggplot(control_resturants_plot_staff, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control resturants staff"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


#Plot all sample resturants - staff

sample_resturants_plot_staff <- data.frame(Staff_05_062019 = sample_resturants$Number_Of_Staff_Before_Covid, 
                                            Staff_05_062020 = sample_resturants$Number_Of_Staff_During_Covid, 
                                            Staff_05_062021 = sample_resturants$Number_Of_Staff_During_Reopen)
sample_resturants_plot_staff <- gather(sample_resturants_plot_staff)

sample_all_staff <-ggplot(sample_resturants_plot_staff, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample resturants staff"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(control_all_staff, sample_all_staff, ncol=2, top = "Staff comparision between all sample and control group")















#Plot low end control resturants - income

control_resturants_low_plot_income <- data.frame(Income_05_062019 = control_low_end_rest$Income_052019_062019, 
                                                 Income_05_062020 = control_low_end_rest$Income_052020_062020, 
                                                 Income_05_062021 = control_low_end_rest$Income_052021_062021)
control_resturants_low_plot_income <- gather(control_resturants_low_plot_income)

income_control_low_end <- ggplot(control_resturants_low_plot_income, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control low-end resturants income"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


#Plot all sample resturants - income

sample_resturants_low_plot_income <- data.frame(Income_05_062019 = sample_low_end_rest$Income_052019_062019, 
                                     Income_05_062020 = sample_low_end_rest$Income_052020_062020, 
                                     Income_05_062021 = sample_low_end_rest$Income_052021_062021)
sample_resturants_low_plot_income <- gather(sample_resturants_low_plot_income)

income_sample_low_end <-ggplot(sample_resturants_low_plot_income, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample low-end resturants income"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(income_control_low_end, income_sample_low_end, ncol=2, top = "Income comparision between low-end resturants in sample and control group")



#Plot low end control resturants - profit

control_resturants_low_plot_profit <- data.frame(Profit_05_062019 = control_low_end_rest$Profit_052019_062019, 
                                                 Profit_05_062020 = control_low_end_rest$Profit_052020_062020, 
                                                 Profit_05_062021 = control_low_end_rest$Profit_052021_062021)
control_resturants_low_plot_profit <- gather(control_resturants_low_plot_profit)

profit_control_low_end <- ggplot(control_resturants_low_plot_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control low-end resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))

#Plot low end  sample resturants - profit

sample_resturants_low_plot_profit <- data.frame(Profit_05_062019 = sample_low_end_rest$Profit_052019_062019, 
                                            Profit_05_062020 = sample_low_end_rest$Profit_052020_062020, 
                                            Profit_05_062021 = sample_low_end_rest$Profit_052021_062021)
sample_resturants_low_plot_profit <- gather(sample_resturants_low_plot_profit)

profit_sample_low_end <-ggplot(sample_resturants_low_plot_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample low-end resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(profit_control_low_end, profit_sample_low_end, ncol=2, top = "Profit comparision between low-end resturants in sample and control group")



#Plot low end control resturants - staff

control_resturants_low_end_plot_staff <- data.frame(Staff_05_062019 = control_low_end_rest$Number_Of_Staff_Before_Covid, 
                                            Staff_05_062020 = control_low_end_rest$Number_Of_Staff_During_Covid, 
                                            Staff_05_062021 = control_low_end_rest$Number_Of_Staff_During_Reopen)
control_resturants_low_end_plot_staff <- gather(control_resturants_low_end_plot_staff)

control_low_end_staff <- ggplot(control_resturants_low_end_plot_staff, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control low-end resturants staff"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


#Plot all sample resturants - staff

sample_resturants_low_end_plot_staff <- data.frame(Staff_05_062019 = sample_low_end_rest$Number_Of_Staff_Before_Covid, 
                                           Staff_05_062020 = sample_low_end_rest$Number_Of_Staff_During_Covid, 
                                           Staff_05_062021 = sample_low_end_rest$Number_Of_Staff_During_Reopen)
sample_resturants_low_end_plot_staff <- gather(sample_resturants_low_end_plot_staff)

sample_low_end_staff <-ggplot(sample_resturants_low_end_plot_staff, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample low-end resturants staff"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(control_low_end_staff, sample_low_end_staff, ncol=2, top = "Staff comparision between low-end resturants sample and control group")




















#Plot average control resturants - income

control_resturants_average_plot_income <- data.frame(Income_05_062019 = control_average_rest$Income_052019_062019, 
                                                 Income_05_062020 = control_average_rest$Income_052020_062020, 
                                                 Income_05_062021 = control_average_rest$Income_052021_062021)
control_resturants_average_plot_income <- gather(control_resturants_average_plot_income)

income_control_average <- ggplot(control_resturants_average_plot_income, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control average resturants income"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


#Plot average sample resturants - income

sample_resturants_average_plot_income <- data.frame(Income_05_062019 = sample_average_rest$Income_052019_062019, 
                                                Income_05_062020 = sample_average_rest$Income_052020_062020, 
                                                Income_05_062021 = sample_average_rest$Income_052021_062021)
sample_resturants_average_plot_income <- gather(sample_resturants_average_plot_income)

income_sample_average <-ggplot(sample_resturants_average_plot_income, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample average resturants income"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(income_control_average, income_sample_average, ncol=2, top = "Income comparision between average resturants in sample and control group")



#Plot average control resturants - profit

control_resturants_average_profit <- data.frame(Profit_05_062019 = control_average_rest$Profit_052019_062019, 
                                                 Profit_05_062020 = control_average_rest$Profit_052020_062020, 
                                                 Profit_05_062021 = control_average_rest$Profit_052021_062021)
control_resturants_average_profit <- gather(control_resturants_average_profit)

profit_control_average <- ggplot(control_resturants_average_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control average resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))

#Plot average  sample resturants - profit

sample_resturants_average_profit <- data.frame(Profit_05_062019 = sample_average_rest$Profit_052019_062019, 
                                                Profit_05_062020 = sample_average_rest$Profit_052020_062020, 
                                                Profit_05_062021 = sample_average_rest$Profit_052021_062021)
sample_resturants_average_profit <- gather(sample_resturants_average_profit)

profit_sample_average <-ggplot(sample_resturants_average_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample average resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(profit_control_average, profit_sample_average, ncol=2, top = "Profit comparision between average resturants in sample and control group")



#Plot low end control resturants - staff

control_resturants_average_plot_staff <- data.frame(Staff_05_062019 = control_average_rest$Number_Of_Staff_Before_Covid, 
                                                    Staff_05_062020 = control_average_rest$Number_Of_Staff_During_Covid, 
                                                    Staff_05_062021 = control_average_rest$Number_Of_Staff_During_Reopen)
control_resturants_average_plot_staff <- gather(control_resturants_average_plot_staff)

control_average_staff <- ggplot(control_resturants_average_plot_staff, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control average resturants staff"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


#Plot all sample resturants - staff

sample_resturants_average_plot_staff <- data.frame(Staff_05_062019 = sample_average_rest$Number_Of_Staff_Before_Covid, 
                                                   Staff_05_062020 = sample_average_rest$Number_Of_Staff_During_Covid, 
                                                   Staff_05_062021 = sample_average_rest$Number_Of_Staff_During_Reopen)
sample_resturants_average_plot_staff <- gather(sample_resturants_average_plot_staff)

sample_average_staff <-ggplot(sample_resturants_average_plot_staff, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample average resturants staff"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(control_average_staff, sample_average_staff, ncol=2, top = "Staff comparision between average resturants sample and control group")











#Plot high end control resturants - income

control_resturants_high_plot_income <- data.frame(Income_05_062019 = control_high_end_rest$Income_052019_062019, 
                                                 Income_05_062020 = control_high_end_rest$Income_052020_062020, 
                                                 Income_05_062021 = control_high_end_rest$Income_052021_062021)
control_resturants_high_plot_income <- gather(control_resturants_high_plot_income)

income_control_high_end <- ggplot(control_resturants_high_plot_income, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control high-end resturants income"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


#Plot all sample resturants - income

sample_resturants_high_plot_income <- data.frame(Income_05_062019 = sample_high_end_rest$Income_052019_062019, 
                                                Income_05_062020 = sample_high_end_rest$Income_052020_062020, 
                                                Income_05_062021 = sample_high_end_rest$Income_052021_062021)
sample_resturants_high_plot_income <- gather(sample_resturants_high_plot_income)

income_sample_high_end <-ggplot(sample_resturants_high_plot_income, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample high-end resturants income"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(income_control_high_end, income_sample_high_end, ncol=2, top = "Income comparision between high-end resturants in sample and control group")



#Plot high end control resturants - profit

control_resturants_high_plot_profit <- data.frame(Profit_05_062019 = control_high_end_rest$Profit_052019_062019, 
                                                 Profit_05_062020 = control_high_end_rest$Profit_052020_062020, 
                                                 Profit_05_062021 = control_high_end_rest$Profit_052021_062021)
control_resturants_high_plot_profit <- gather(control_resturants_high_plot_profit)

profit_control_high_end <- ggplot(control_resturants_high_plot_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control high-end resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))

#Plot high end  sample resturants - profit

sample_resturants_high_plot_profit <- data.frame(Profit_05_062019 = sample_high_end_rest$Profit_052019_062019, 
                                                Profit_05_062020 = sample_high_end_rest$Profit_052020_062020, 
                                                Profit_05_062021 = sample_high_end_rest$Profit_052021_062021)
sample_resturants_high_plot_profit <- gather(sample_resturants_high_plot_profit)

profit_sample_high_end <-ggplot(sample_resturants_high_plot_profit, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample high-end resturants profit"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


grid.arrange(profit_control_high_end, profit_sample_high_end, ncol=2, top = "Profit comparision between high-end resturants in sample and control group")




#Plot high end control resturants - staff

control_resturants_high_end_plot_staff <- data.frame(Staff_05_062019 = control_high_end_rest$Number_Of_Staff_Before_Covid, 
                                                     Staff_05_062020 = control_high_end_rest$Number_Of_Staff_During_Covid, 
                                                     Staff_05_062021 = control_high_end_rest$Number_Of_Staff_During_Reopen)
control_resturants_high_end_plot_staff <- gather(control_resturants_high_end_plot_staff)

control_high_end_staff <- ggplot(control_resturants_high_end_plot_staff, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Control high-end resturants staff"))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))


#Plot all sample resturants - staff

sample_resturants_high_end_plot_staff <- data.frame(Staff_05_062019 = sample_high_end_rest$Number_Of_Staff_Before_Covid, 
                                                    Staff_05_062020 = sample_high_end_rest$Number_Of_Staff_During_Covid, 
                                                    Staff_05_062021 = sample_high_end_rest$Number_Of_Staff_During_Reopen)
sample_resturants_high_end_plot_staff <- gather(sample_resturants_high_end_plot_staff)

sample_high_end_staff <-ggplot(sample_resturants_high_end_plot_staff, aes(x = value, fill = key)) +
  geom_density(kernel = "gaussian", alpha = 0.1) + guides(fill=guide_legend(title="Sample high-end resturants staff"),
                                                          shape = guide_legend(override.aes = list(size = 0.5)))+ 
  theme(legend.title = element_text(size = 5), legend.text = element_text(size = 5), legend.position = c(0.82, 0.9))
        
grid.arrange(control_high_end_staff, sample_high_end_staff, ncol=2, top = "Staff comparision between high-end resturants sample and control group")


```


## Survey Description

The survey was released to those businesses who answered “Yes” upon the initial contact from the government. Those who answered the survey were part of the sample for this study. The survey was produced by Petit Poll, a company employed by the Ontario Government, and a link can be found [__here__](https://docs.google.com/forms/d/e/1FAIpQLSeafb8VzHCH_0ZQVKnfg46_E6WHMVqnADwMcg7nOqaibhFweg/viewform?usp=sf_link). The survey contained sections about contact information, background and workforce, and performance. The survey looked to generate data about 3 distinct time periods: pre-pandemic, lockdown, and during re-opening. 

&nbsp;

The first section of the survey is used to gain contact information for the business. Name, address, phone numbers, etc. The second section focuses on background and workforce. This is where we begin to ask about the effects of COVID-19 and re-opening. In this section, we ask about restaurant background, as well as how their number of hours and number of employees has changed due to the pandemic. In the final section, we ask questions about income and profit. We also ask, on a 5-point scale, how helpful it was in the eyes of the business owner to open for a few months. 

&nbsp;

As with any survey, there is the possibility of non-responses. If the non-response comes from the control group, then they are not eligible for compensation, which is the opportunity to re-open their business. We believe this to be a strong enough incentive to get a significant response rate from the control group. For the businesses who did open, they will have a period of 2 weeks to complete the survey, with a reminder email and phone call. After 2 weeks of no-response, they will be emailed and phoned daily to try and generate a response from the restaurant owner. If there is still no response at this point, they will be informed that when the COVID-19 pandemic restrictions are lifted, they will be held back from opening for a significant period of time. Hopefully, this is enough to entice the participant to respond. 

&nbsp;

To ensure participants' privacy, all information from the survey will be collected under the Freedom of Information and Protection of Privacy Act. Their responses of the survey will not be shared with anyone, other than the Ontario Government. 

&nbsp;

Since financial compensation is not being offered in this study, the cost will be the amount allotted to Petit Poll in the employment contract. However, it is possible that opening dine-in restaurants will increase the number of COVID-19 cases. This could increase cost for the healthcare profession indirectly. 

&nbsp;

Screenshots of the different survey questions have been attached below. 

&nbsp;

```{r, fig.align='center', out.width="95%", out.height="95%", echo=FALSE, message=FALSE, message = FALSE}
library(here)
library(knitr)

knitr::include_graphics(path = here("inputs/Images/Survey_Page1A.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page1B.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page2A.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page2B.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page2C.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page3A.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page3B.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page3C.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page3D.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page3E.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page3F.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page4A.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page4B.png"))

knitr::include_graphics(path = here("inputs/Images/Survey_Page4C.png"))


```

\pagebreak
# References 


